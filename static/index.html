<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Lendários - Customer Success</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100% );
            min-height: 100vh; color: #ffffff; overflow-x: hidden;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 40px; position: relative; }
        .header::before { content: ''; position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 100px; height: 4px; background: linear-gradient(90deg, #00D9FF, #FF6B35, #8B5CF6); border-radius: 2px; }
        .header h1 { font-size: 3rem; margin-bottom: 15px; background: linear-gradient(135deg, #00D9FF, #FF6B35); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-weight: 800; display: flex; align-items: center; justify-content: center; gap: 15px; }
        .header h1 img { height: 50px; width: auto; }
        .header p { font-size: 1.3rem; opacity: 0.8; color: #a0a0a0; }
        .controls { display: flex; justify-content: center; gap: 20px; margin-bottom: 30px; flex-wrap: wrap; }
        .filter-btn { padding: 12px 24px; background: rgba(255,255,255,0.1); border: 2px solid transparent; border-radius: 25px; color: white; cursor: pointer; transition: all 0.3s ease; backdrop-filter: blur(10px); font-weight: 600; }
        .filter-btn:hover { background: rgba(0, 217, 255, 0.2); border-color: #00D9FF; transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0, 217, 255, 0.3); }
        .filter-btn.active { background: linear-gradient(135deg, #00D9FF, #FF6B35); border-color: #00D9FF; box-shadow: 0 10px 30px rgba(0, 217, 255, 0.4); }
        .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; margin-bottom: 40px; }
        .summary-card { background: rgba(255,255,255,0.05); border-radius: 20px; padding: 30px; backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); transition: all 0.4s ease; position: relative; overflow: hidden; text-align: center; }
        .summary-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #00D9FF, #FF6B35, #8B5CF6); }
        .summary-card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0, 217, 255, 0.2); background: rgba(255,255,255,0.08); }
        .summary-card h3 { color: #a0a0a0; margin-bottom: 15px; font-size: 1.1rem; font-weight: 500; }
        .summary-card .value { font-size: 3rem; font-weight: 800; background: linear-gradient(135deg, #00D9FF, #FF6B35); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 10px; }
        .summary-card .label { color: #666; font-size: 0.95rem; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 30px; margin-bottom: 40px; }
        .metric-card { background: rgba(255,255,255,0.05); border-radius: 20px; padding: 25px; backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); transition: all 0.4s ease; position: relative; overflow: hidden; }
        .metric-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: var(--metric-color, linear-gradient(90deg,#00D9FF,#FF6B35)); }
        .metric-card:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .metric-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; flex-wrap:wrap; gap:10px; }
        .metric-title { font-size:1.3rem; font-weight:700; color:#ffffff; }
        .metric-status { padding:6px 12px; border-radius:15px; font-size:0.8rem; font-weight:600; color:white; text-transform:uppercase; letter-spacing:0.5px; }
        .status-excelente { background: linear-gradient(135deg, #00D9FF, #00B4D8); box-shadow: 0 5px 15px rgba(0, 217, 255, 0.3); }
        .status-atencao { background: linear-gradient(135deg, #FF6B35, #F77F00); box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3); }
        .status-critico { background: linear-gradient(135deg, #8B5CF6, #7C3AED); box-shadow: 0 5px 15px rgba(139, 92, 246, 0.3); }
        .metric-values { display:grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap:15px; margin-bottom:20px; }
        .value-item { text-align:center; padding:15px; background: rgba(255,255,255,0.05); border-radius:12px; border:1px solid rgba(255,255,255,0.1); transition: all 0.3s ease; }
        .value-item:hover { background: rgba(255,255,255,0.1); transform: scale(1.05); }
        .value-item .number { font-size:1.8rem; font-weight:800; background: linear-gradient(135deg, #00D9FF, #FF6B35); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; margin-bottom:5px; }
        .value-item .label { font-size:0.85rem; color:#a0a0a0; font-weight:500; }
        .progress-container { margin-bottom:15px; }
        .progress-bar { width:100%; height:10px; background: rgba(255,255,255,0.1); border-radius:5px; overflow:hidden; margin-bottom:10px; }
        .progress-fill { height:100%; border-radius:5px; transition: width 1s ease; }
        .progress-text { text-align:center; font-weight:600; color:#ffffff; font-size:1rem; }
        .chart-container { position:relative; height:200px; margin-top:20px; }
        .chart-legend { display:flex; justify-content:center; gap:20px; margin-top:15px; font-size:0.8rem; }
        .legend-item { display:flex; align-items:center; gap:5px; }
        .legend-color { width:12px; height:12px; border-radius:50%; }
        .weekly-trends { background: rgba(255,255,255,0.05); border-radius:20px; padding:30px; backdrop-filter: blur(20px); border:1px solid rgba(255,255,255,0.1); margin-bottom:30px; }
        .weekly-trends h3 { color:#ffffff; margin-bottom:20px; font-size:1.5rem; font-weight:700; }
        .loading { text-align:center; padding:60px; color:#00D9FF; font-size:1.3rem; font-weight:600; }
        .loading::after { content:''; display:inline-block; width:20px; height:20px; border:3px solid rgba(0,217,255,0.3); border-radius:50%; border-top-color:#00D9FF; animation: spin 1s ease-in-out infinite; margin-left:10px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .error { background: linear-gradient(135deg, #FF6B35, #F77F00); color:white; padding:20px; border-radius:15px; margin:20px 0; text-align:center; font-weight:600; box-shadow:0 10px 30px rgba(255,107,53,0.3); }
        .metric-filter-buttons { display:flex; justify-content:center; gap:10px; margin-bottom:20px; flex-wrap:wrap; }
        .no-data-message { text-align:center; padding:40px; color:#a0a0a0; font-size:1.1rem; grid-column:1 / -1; }
        @media (max-width:768px) {
            .header h1 { font-size:2.2rem; }
            .metrics-grid { grid-template-columns: 1fr; }
            .metric-values { grid-template-columns: 1fr; }
            .controls { flex-direction:column; align-items:center; }
            .metric-header { flex-direction:column; align-items:flex-start; }
            .chart-legend { flex-direction:column; align-items:center; gap:10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
             <h1><img id="team-icon" src="/static/icone mapa.png" alt="Ícone da Equipe"> Dashboard Lendários</h1>
            <p>Equipe de Customer Success - Métricas e Performance</p>
        </div>

        <div class="controls">
            <button class="filter-btn active" onclick="showView('overview')">Visão Geral</button>
            <button class="filter-btn" onclick="showView('weekly')">Análise Semanal</button>
            <button class="filter-btn" onclick="showView('trends')">Tendências</button>
        </div>

        <div id="loading" class="loading">Carregando dados do dashboard</div>
        <div id="error" class="error" style="display:none;">Erro ao carregar os dados. Tente novamente.</div>

        <div id="dashboard-content" style="display:none;">
            <div class="summary-cards">
                <div class="summary-card">
                    <h3>Total de Métricas</h3>
                    <div class="value" id="total-metrics">-</div>
                    <div class="label">Métricas monitoradas</div>
                </div>
                <div class="summary-card">
                    <h3>Metas Atingidas</h3>
                    <div class="value" id="metrics-above-target">-</div>
                    <div class="label">Acima do objetivo</div>
                </div>
                <div class="summary-card">
                    <h3>Metas não Atingidas</h3>
                    <div class="value" id="metrics-below-target">-</div>
                    <div class="label">Abaixo do objetivo</div>
                </div>
                <div class="summary-card">
                    <h3>Performance Geral</h3>
                    <div class="value" id="performance-percentage">-</div>
                    <div class="label">% de sucesso</div>
                </div>
            </div>

            <div id="overview-view">
                <div class="metrics-grid" id="metrics-container"></div>
            </div>

            <div id="weekly-view" style="display:none;">
                <div class="metric-filter-buttons" id="weekly-metric-filter-buttons"></div>
                <div class="metrics-grid" id="weekly-metrics-container"></div>
            </div>

            <div id="trends-view" style="display:none;">
                <div class="weekly-trends">
                    <h3>📈 Tendências Semanais</h3>
                    <div class="chart-container"><canvas id="trends-chart"></canvas></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentData = null;
        let currentWeeklyData = null;
        let currentView = 'overview';
        let currentWeeklyMetricFilter = 'all';
        let trendsChartInstance = null;

        // Busca os dados do backend
        async function fetchDashboardData() {
            try {
                const [metricsResponse, weeklyResponse] = await Promise.all([
                    fetch('/api/dashboard/metrics'),
                    fetch('/api/dashboard/weekly-data')
                ]);

                if (!metricsResponse.ok || !weeklyResponse.ok) {
                    throw new Error('Erro ao buscar dados (status não OK)');
                }

                const metricsData = await metricsResponse.json();
                const weeklyData = await weeklyResponse.json();

                if (!metricsData.success || !weeklyData.success) {
                    throw new Error('Erro nos dados retornados pela API');
                }

                const summaryData = calculateSummary(metricsData.data);

                return {
                    metrics: metricsData.data || [],
                    summary: summaryData,
                    weekly: weeklyData.data || {}
                };
            } catch (error) {
                console.error('fetchDashboardData error:', error);
                throw error;
            }
        }

        // Calcula o resumo a partir das métricas
        function calculateSummary(metricsData) {
            if (!Array.isArray(metricsData)) metricsData = [];

            let metricsAboveTarget = 0;
            let metricsBelowTarget = 0;

            metricsData.forEach(metric => {
                const metaPercentual = Number(metric.meta_percentual ?? 0);
                let percentual = Number(metric.total_mes?.percentual ?? 0);
                // Trata casos em que a API retorna 0..1 ou 0..100
                if (percentual > 1) percentual = percentual / 100;

                if ((metric.metrica || '').includes('Churn')) {
                    if (percentual <= metaPercentual) {
                        metricsAboveTarget++;
                    } else {
                        metricsBelowTarget++;
                    }
                } else {
                    if (percentual >= metaPercentual) {
                        metricsAboveTarget++;
                    } else {
                        metricsBelowTarget++;
                    }
                }
            });

            const totalMetrics = metricsData.length;
            const performancePercentage = totalMetrics > 0 ? (metricsAboveTarget / totalMetrics) * 100 : 0;

            return {
                total_metrics: totalMetrics,
                metrics_above_target: metricsAboveTarget,
                metrics_below_target: metricsBelowTarget,
                performance_percentage: performancePercentage
            };
        }

        function renderSummary(summaryData) {
            document.getElementById('total-metrics').textContent = summaryData.total_metrics;
            document.getElementById('metrics-above-target').textContent = summaryData.metrics_above_target;
            document.getElementById('metrics-below-target').textContent = summaryData.metrics_below_target;
            document.getElementById('performance-percentage').textContent = summaryData.performance_percentage.toFixed(1) + '%';
        }

        function slugifyMetric(metrica) {
            return String(metrica || '')
                .normalize('NFKD')
                .replace(/\p{Diacritic}/gu, '')
                .replace(/\s+/g, '-')
                .toLowerCase()
                .replace(/[^a-z0-9-_]/g, '') || 'metric';
        }

        function createMetricCard(metric) {
            const metricId = slugifyMetric(metric.metrica);
            const statusClass = `status-${(metric.status || '').toLowerCase()}`;
            const total = metric.total_mes?.total ?? 0;
            const cumprido = metric.total_mes?.cumprido ?? 0;
            let percentual = Number(metric.total_mes?.percentual ?? 0);
            if (percentual > 1) percentual = percentual / 100; // normaliza 0..1

            return `
                <div class="metric-card" style="--metric-color: ${metric.cor || 'linear-gradient(90deg,#00D9FF,#FF6B35)'}">
                    <div class="metric-header">
                        <div class="metric-title">${metric.metrica || '-'}</div>
                        <div class="metric-status ${statusClass}">${metric.status || '-'}</div>
                    </div>

                    <div class="metric-values">
                        <div class="value-item">
                            <div class="number">${total}</div>
                            <div class="label">Total</div>
                        </div>
                        <div class="value-item">
                            <div class="number">${cumprido}</div>
                            <div class="label">${(metric.metrica || '').includes('Churn') ? 'Ocorrências' : 'Cumprido'}</div>
                        </div>
                    </div>

                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.max(0, percentual * 100).toFixed(1)}%; background: ${metric.cor || '#00D9FF'};"></div>
                        </div>
                        <div class="progress-text">
                            ${ (Math.max(0, percentual * 100)).toFixed(1) }% da meta (${metric.meta_objetivo ?? '-'})
                        </div>
                    </div>

                    <div class="chart-container">
                        <canvas id="chart-${metricId}"></canvas>
                    </div>

                    <div class="chart-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: ${metric.cor || '#00D9FF'}"></div>
                            <span>Cumprido</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: rgba(255, 255, 255, 0.1)"></div>
                            <span>Restante</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function createChart(metric) {
            const metricId = slugifyMetric(metric.metrica);
            const canvas = document.getElementById(`chart-${metricId}`);
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const total = Number(metric.total_mes?.total ?? 0);
            const cumprido = Number(metric.total_mes?.cumprido ?? 0);
            const remaining = Math.max(0, total - cumprido);

            const existing = Chart.getChart(canvas);
            if (existing) existing.destroy();

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Cumprido', 'Restante'],
                    datasets: [{
                        data: [cumprido, remaining],
                        backgroundColor: [metric.cor || '#00D9FF', 'rgba(255, 255, 255, 0.1)'],
                        borderWidth: 0,
                        spacing: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: { legend: { display: false }, tooltip: { enabled: false } }
                }
            });
        }

        function createWeeklyCard(metric, semana) {
            if (!semana || !semana.periodo || semana.periodo === 'Total Mês' || typeof semana.total !== 'number' || isNaN(semana.total) || semana.total === 0) {
                return '';
            }

            const statusClass = `status-${(semana.status || '').toLowerCase()}`;
            let percentual = Number(semana.percentual ?? 0);
            if (percentual > 1) percentual = percentual / 100;

            return `
                <div class="metric-card" style="--metric-color: ${metric.cor || '#00D9FF'}">
                    <div class="metric-header">
                        <div class="metric-title">${metric.metrica} - ${semana.periodo}</div>
                        <div class="metric-status ${statusClass}">${semana.status || '-'}</div>
                    </div>

                    <div class="metric-values">
                        <div class="value-item">
                            <div class="number">${semana.total}</div>
                            <div class="label">Total</div>
                        </div>
                        <div class="value-item">
                            <div class="number">${semana.cumprido}</div>
                            <div class="label">${(metric.metrica || '').includes('Churn') ? 'Ocorrências' : 'Cumprido'}</div>
                        </div>
                    </div>

                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.max(0, percentual * 100).toFixed(1)}%; background: ${metric.cor || '#00D9FF'};"></div>
                        </div>
                        <div class="progress-text">
                            ${ (Math.max(0, percentual * 100)).toFixed(1) }% da meta (${metric.meta_objetivo ?? '-'})
                        </div>
                    </div>
                </div>
            `;
        }

        function normalizeSeries(series, labelsLength) {
            if (!Array.isArray(series)) return Array.from({length: labelsLength}, () => 0);
            const nums = series.map(v => Number(v ?? 0));
            const maxVal = Math.max(...nums, 0);
            if (maxVal <= 1) return nums.map(n => n * 100); // converter 0..1 -> 0..100
            return nums;
        }

        function createTrendsChart(weeklyData) {
            const canvas = document.getElementById('trends-chart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');

            const semanas = Array.isArray(weeklyData.semanas) ? weeklyData.semanas : [];
            const csat = normalizeSeries(weeklyData.csat, semanas.length);
            const sla = normalizeSeries(weeklyData.sla, semanas.length);
            const cobertura = normalizeSeries(weeklyData.cobertura, semanas.length);
            const churn = normalizeSeries(weeklyData.churn, semanas.length);

            if (trendsChartInstance) trendsChartInstance.destroy();

            trendsChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: semanas,
                    datasets: [
                        { label: 'CSAT (%)', data: csat, borderColor: '#00D9FF', backgroundColor: 'rgba(0, 217, 255, 0.1)', tension: 0.4, fill: true, pointBackgroundColor: '#00D9FF', pointBorderColor: '#ffffff', pointRadius: 5, pointHoverRadius: 7 },
                        { label: 'SLA dos DS (%)', data: sla, borderColor: '#FF6B35', backgroundColor: 'rgba(255, 107, 53, 0.1)', tension: 0.4, fill: true, pointBackgroundColor: '#FF6B35', pointBorderColor: '#ffffff', pointRadius: 5, pointHoverRadius: 7 },
                        { label: 'Cobertura de Carteira (%)', data: cobertura, borderColor: '#8B5CF6', backgroundColor: 'rgba(139, 92, 246, 0.1)', tension: 0.4, fill: true, pointBackgroundColor: '#8B5CF6', pointBorderColor: '#ffffff', pointRadius: 5, pointHoverRadius: 7 },
                        { label: 'Cancelamento - Churn (%)', data: churn, borderColor: '#FBE842', backgroundColor: 'rgba(251, 232, 66, 0.1)', tension: 0.4, fill: true, pointBackgroundColor: '#FBE842', pointBorderColor: '#ffffff', pointRadius: 5, pointHoverRadius: 7 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top', labels: { color: '#ffffff', font: { size: 12, weight: '600' }, padding: 20, usePointStyle: true } },
                        tooltip: { backgroundColor: 'rgba(0,0,0,0.8)', titleColor: '#ffffff', bodyColor: '#ffffff', borderColor: 'rgba(255,255,255,0.2)', borderWidth: 1, cornerRadius: 8, displayColors: true, mode: 'index', intersect: false }
                    },
                    scales: { x: { ticks: { color: '#ffffff', font: { size: 11 } }, grid: { color: 'rgba(255,255,255,0.1)' } }, y: { ticks: { color: '#ffffff', font: { size: 11 }, callback: function(value) { return value + '%'; } }, grid: { color: 'rgba(255,255,255,0.1)' }, suggestedMin: 0, suggestedMax: 100 } },
                    interaction: { mode: 'index', intersect: false }
                }
            });
        }

        function renderMetrics(metricsData) {
            const container = document.getElementById('metrics-container');
            if (!Array.isArray(metricsData)) metricsData = [];
            container.innerHTML = metricsData.map(createMetricCard).join('');

            // Criar gráficos após inserir no DOM
            setTimeout(() => { metricsData.forEach(createChart); }, 100);
        }

        function renderWeeklyMetrics(metricsData, filterMetric = 'all') {
            const container = document.getElementById('weekly-metrics-container');
            if (!Array.isArray(metricsData)) metricsData = [];

            let html = '';
            let hasValidData = false;

            const filteredMetrics = filterMetric === 'all' ? metricsData : metricsData.filter(metric => slugifyMetric(metric.metrica) === filterMetric);

            filteredMetrics.forEach(metric => {
                if (!Array.isArray(metric.semanas)) return;
                metric.semanas.forEach(semana => {
                    const cardHtml = createWeeklyCard(metric, semana);
                    if (cardHtml) { html += cardHtml; hasValidData = true; }
                });
            });

            if (!hasValidData) {
                html = '<div class="no-data-message">⏳ Aguardando dados das semanas...<br><small>Preencha as semanas restantes na planilha Excel</small></div>';
            }

            container.innerHTML = html;
        }

        function createWeeklyMetricFilterButtons(metricsData) {
            const container = document.getElementById('weekly-metric-filter-buttons');
            if (!Array.isArray(metricsData)) metricsData = [];

            let buttonsHtml = '';
            buttonsHtml += `<button class="filter-btn ${currentWeeklyMetricFilter === 'all' ? 'active' : ''}" onclick="filterWeeklyMetrics('all')">Todas</button>`;

            metricsData.forEach(metric => {
                const metricId = slugifyMetric(metric.metrica);
                const activeClass = currentWeeklyMetricFilter === metricId ? 'active' : '';
                buttonsHtml += `<button class="filter-btn ${activeClass}" onclick="filterWeeklyMetrics('${metricId}')">${metric.metrica}</button>`;
            });

            container.innerHTML = buttonsHtml;
        }

        function filterWeeklyMetrics(metricId) {
            currentWeeklyMetricFilter = metricId;
            createWeeklyMetricFilterButtons(currentData.metrics);
            renderWeeklyMetrics(currentData.metrics, currentWeeklyMetricFilter);
        }

        function showView(view) {
            document.querySelectorAll('.controls .filter-btn').forEach(btn => btn.classList.remove('active'));
            const selector = `.controls .filter-btn[onclick="showView('${view}')"]`;
            const btn = document.querySelector(selector);
            if (btn) btn.classList.add('active');

            document.getElementById('overview-view').style.display = 'none';
            document.getElementById('weekly-view').style.display = 'none';
            document.getElementById('trends-view').style.display = 'none';

            currentView = view;

            if (view === 'overview') {
                document.getElementById('overview-view').style.display = 'block';
            } else if (view === 'weekly') {
                document.getElementById('weekly-view').style.display = 'block';
                if (currentData) {
                    createWeeklyMetricFilterButtons(currentData.metrics);
                    renderWeeklyMetrics(currentData.metrics, currentWeeklyMetricFilter);
                }
            } else if (view === 'trends') {
                document.getElementById('trends-view').style.display = 'block';
                if (currentWeeklyData) { setTimeout(() => createTrendsChart(currentWeeklyData), 100); }
            }
        }

        async function loadDashboard() {
            try {
                const data = await fetchDashboardData();
                currentData = data;
                currentWeeklyData = data.weekly;

                renderSummary(data.summary);
                renderMetrics(data.metrics);

                if (currentView === 'weekly') {
                    createWeeklyMetricFilterButtons(currentData.metrics);
                    renderWeeklyMetrics(currentData.metrics, currentWeeklyMetricFilter);
                }

                document.getElementById('loading').style.display = 'none';
                document.getElementById('dashboard-content').style.display = 'block';
                document.getElementById('error').style.display = 'none';

            } catch (error) {
                console.error('Erro ao carregar dashboard:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
            }
        }

        document.addEventListener('DOMContentLoaded', loadDashboard);
        setInterval(loadDashboard, 30000);
    </script>
</body>
</html>
